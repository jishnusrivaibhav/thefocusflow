<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Focus Flow - Pomodoro Study Timer</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="Gamified Pomodoro timer with RPG leveling, streak tracking, and focus music">
    <meta name="theme-color" content="#E63946">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Focus Flow">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Icons -->
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 192 192'%3E%3Crect fill='%230D1117' width='192' height='192'/%3E%3Ctext x='96' y='130' font-size='100' text-anchor='middle' fill='%23E63946'%3EðŸŽ¯%3C/text%3E%3C/svg%3E">
    
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --focus-red: #E63946;
            --break-green: #06FFA5;
            --long-break-blue: #4CC9F0;
            --dark-bg: #0D1117;
            --card-bg: #161B22;
            --text-primary: #F0F6FC;
            --text-secondary: #8B949E;
            --border-color: #30363D;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            margin: 0;
            padding: 0;
            height: 100vh;
            overflow: hidden;
            font-family: 'DM Sans', sans-serif;
            background: var(--dark-bg);
            color: var(--text-primary);
            position: relative;
        }
        
        /* Animated background gradient */
        body::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle at 20% 50%, rgba(230, 57, 70, 0.15) 0%, transparent 50%),
                        radial-gradient(circle at 80% 80%, rgba(76, 201, 240, 0.15) 0%, transparent 50%),
                        radial-gradient(circle at 40% 20%, rgba(6, 255, 165, 0.1) 0%, transparent 50%);
            animation: moveGradient 20s ease infinite;
            pointer-events: none;
        }
        
        @keyframes moveGradient {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            33% { transform: translate(-5%, -10%) rotate(60deg); }
            66% { transform: translate(5%, 5%) rotate(-60deg); }
        }
        
        .container {
            height: 100vh;
            width: 100vw;
            margin: 0;
            padding: 0;
            overflow: hidden;
            position: relative;
            z-index: 1;
        }
        
        .app-header {
            text-align: center;
            padding: 15px 0 10px 0;
            margin: 0 auto;
            max-width: 1400px;
            animation: fadeIn 0.8s ease;
        }
        
        .app-header img {
            width: 80px !important;
            height: 80px !important;
            margin: 0 auto 8px !important;
            display: block !important;
            border-radius: 16px !important;
            box-shadow: 0 4px 16px rgba(6, 255, 165, 0.3) !important;
        }
        
        /* Dashboard Grid Layout - No Ocean */
        .dashboard-container {
            height: calc(100vh - 120px);
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px 20px 20px;
            display: grid;
            gap: 20px;
            grid-template-columns: 320px 1fr 320px;
            grid-template-rows: auto auto auto auto;
            align-content: start;
            align-items: start;
            overflow-y: auto;
            overflow-x: hidden;
            grid-template-areas: 
                "goals timer progress"
                "goals audio progress"
                "consistency consistency consistency"
                "rank rank rank";
        }
        
        .goals-area { 
            grid-area: goals;
            align-self: start;
            overflow-y: auto;
            max-height: calc(100vh - 140px);
        }
        
        .timer-area { 
            grid-area: timer;
            align-self: start;
        }
        
        .progress-area { 
            grid-area: progress;
            align-self: start;
            overflow-y: auto;
            max-height: calc(100vh - 140px);
        }
        
        .audio-area { 
            grid-area: audio;
            align-self: start;
        }
        
        .consistency-area { 
            grid-area: consistency;
            width: 100%;
            height: auto;
            align-self: start;
        }
        
        .rank-area { 
            grid-area: rank;
            width: 100%;
            height: auto;
            align-self: start;
            background: linear-gradient(90deg, #1a1a1a, #0f172a);
            border: 1px solid #2dd4bf;
        }
        
        /* Hide old layout */
        .main-grid {
            display: none !important;
        }
        
        /* Responsive */
        @media (max-width: 1200px) {
            .dashboard-container {
                grid-template-columns: 1fr 1fr;
                grid-template-areas: 
                    "goals timer"
                    "progress progress"
                    "audio audio"
                    "consistency consistency"
                    "rank rank";
            }
        }
        
        @media (max-width: 768px) {
            body {
                height: auto;
            }
            
            .dashboard-container {
                grid-template-columns: 1fr;
                grid-template-areas: 
                    "goals"
                    "timer"
                    "progress"
                    "audio"
                    "consistency"
                    "rank";
            }
        }
        
        .app-header {
            text-align: center;
            margin-bottom: 40px;
            animation: slideDown 0.6s ease;
        }
        
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .app-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 48px;
            letter-spacing: 4px;
            background: linear-gradient(135deg, var(--focus-red), var(--break-green));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
        }
        
        .app-subtitle {
            font-size: 14px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        .timer-card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 24px;
            padding: 40px 30px;
            margin-bottom: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: fadeIn 0.8s ease 0.2s both;
            position: relative;
            overflow: hidden;
            max-height: 600px;
            width: 100%;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        
        /* Glow effect on active timer */
        .timer-card.active-focus::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, var(--focus-red), transparent);
            border-radius: 24px;
            opacity: 0.5;
            z-index: -1;
            animation: pulse 2s ease infinite;
        }
        
        .timer-card.active-break::before {
            background: linear-gradient(45deg, var(--break-green), transparent);
        }
        
        .timer-card.active-long-break::before {
            background: linear-gradient(45deg, var(--long-break-blue), transparent);
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.6; }
        }
        
        .mode-indicator {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .mode-label {
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 3px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }
        
        .mode-name {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 32px;
            letter-spacing: 2px;
            transition: color 0.3s ease;
        }
        
        .mode-name.focus { color: var(--focus-red); }
        .mode-name.break { color: var(--break-green); }
        .mode-name.long-break { color: var(--long-break-blue); }
        
        .timer-display {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .circular-timer {
            position: relative;
            width: 200px;
            height: 200px;
        }
        
        .circular-timer svg {
            transform: rotate(-90deg);
            width: 100%;
            height: 100%;
        }
        
        .circular-timer-bg {
            fill: none;
            stroke: rgba(139, 148, 158, 0.2);
            stroke-width: 8;
        }
        
        .circular-timer-progress {
            fill: none;
            stroke: var(--focus-red);
            stroke-width: 8;
            stroke-linecap: round;
            transition: stroke-dashoffset 0.3s linear, stroke 0.3s ease;
        }
        
        .circular-timer-progress.break {
            stroke: var(--break-green);
        }
        
        .circular-timer-progress.long-break {
            stroke: var(--long-break-blue);
        }
        
        .circular-timer-progress.ticking {
            transition: stroke-dashoffset 1s linear;
        }
        
        .timer-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }
        
        .time {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 48px;
            letter-spacing: 4px;
            line-height: 1;
            transition: all 0.3s ease;
        }
        
        .time.focus { color: var(--focus-red); }
        .time.break { color: var(--break-green); }
        .time.long-break { color: var(--long-break-blue); }
        
        .timer-mode-label {
            font-size: 11px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-top: 8px;
        }
        
        .progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(139, 148, 158, 0.2);
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 30px;
        }
        
        .progress-fill {
            height: 100%;
            background: var(--focus-red);
            border-radius: 3px;
            transition: width 0.1s linear, background-color 0.3s ease;
        }
        
        .progress-fill.break { background: var(--break-green); }
        .progress-fill.long-break { background: var(--long-break-blue); }
        
        .controls {
            display: flex;
            gap: 12px;
            margin-bottom: 25px;
        }
        
        .btn {
            flex: 1;
            padding: 18px 24px;
            border: none;
            border-radius: 12px;
            font-family: 'DM Sans', sans-serif;
            font-size: 16px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.4s ease, height 0.4s ease;
        }
        
        .btn:active::before {
            width: 300px;
            height: 300px;
        }
        
        .btn-primary {
            background: var(--focus-red);
            color: white;
        }
        
        .btn-primary:hover {
            background: #d62839;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(230, 57, 70, 0.4);
        }
        
        .btn-secondary {
            background: var(--card-bg);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }
        
        .btn-secondary:hover {
            background: #1C2128;
            border-color: #484F58;
            transform: translateY(-2px);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .fullscreen-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 10px 12px;
            background: transparent;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 18px;
        }
        
        .fullscreen-btn:hover {
            background: rgba(230, 57, 70, 0.1);
            border-color: var(--focus-red);
            color: var(--focus-red);
        }
        
        /* Fullscreen overlay */
        .fullscreen-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--dark-bg);
            z-index: 9999;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            padding: 40px;
        }
        
        .fullscreen-overlay.active {
            display: flex;
        }
        
        .fullscreen-content {
            text-align: center;
            max-width: 600px;
            width: 100%;
        }
        
        .fullscreen-mode-name {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 48px;
            letter-spacing: 4px;
            margin-bottom: 40px;
            transition: color 0.3s ease;
        }
        
        .fullscreen-mode-name.focus { color: var(--focus-red); }
        .fullscreen-mode-name.break { color: var(--break-green); }
        .fullscreen-mode-name.long-break { color: var(--long-break-blue); }
        
        .fullscreen-timer {
            position: relative;
            width: 320px;
            height: 320px;
            margin: 0 auto 50px;
        }
        
        .fullscreen-timer svg {
            transform: rotate(-90deg);
            width: 100%;
            height: 100%;
        }
        
        .fullscreen-timer-bg {
            fill: none;
            stroke: rgba(139, 148, 158, 0.2);
            stroke-width: 12;
        }
        
        .fullscreen-timer-progress {
            fill: none;
            stroke: var(--focus-red);
            stroke-width: 12;
            stroke-linecap: round;
            transition: stroke-dashoffset 1s linear, stroke 0.3s ease;
        }
        
        .fullscreen-timer-progress.break {
            stroke: var(--break-green);
        }
        
        .fullscreen-timer-progress.long-break {
            stroke: var(--long-break-blue);
        }
        
        .fullscreen-timer-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }
        
        .fullscreen-time {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 80px;
            letter-spacing: 8px;
            line-height: 1;
            transition: all 0.3s ease;
        }
        
        .fullscreen-time.focus { color: var(--focus-red); }
        .fullscreen-time.break { color: var(--break-green); }
        .fullscreen-time.long-break { color: var(--long-break-blue); }
        
        .fullscreen-label {
            font-size: 14px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-top: 12px;
        }
        
        .fullscreen-controls {
            display: flex;
            gap: 20px;
            justify-content: center;
        }
        
        .fullscreen-controls .btn {
            min-width: 140px;
        }
        
        .exit-fullscreen-btn {
            position: absolute;
            top: 30px;
            right: 30px;
            padding: 12px 24px;
            background: transparent;
            border: 1px solid var(--border-color);
            border-radius: 10px;
            color: var(--text-secondary);
            font-family: 'DM Sans', sans-serif;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .exit-fullscreen-btn:hover {
            background: rgba(230, 57, 70, 0.1);
            border-color: var(--focus-red);
            color: var(--focus-red);
        }
        
        .fullscreen-stats {
            margin-top: 40px;
            display: flex;
            gap: 30px;
            justify-content: center;
        }
        
        .fullscreen-stat {
            text-align: center;
        }
        
        .fullscreen-stat-value {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 32px;
            color: var(--focus-red);
            letter-spacing: 2px;
        }
        
        .fullscreen-stat-label {
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 4px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            animation: fadeIn 1s ease 0.4s both;
        }
        
        .stat-card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            border-color: var(--focus-red);
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(230, 57, 70, 0.2);
        }
        
        .stat-value {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 36px;
            color: var(--focus-red);
            letter-spacing: 2px;
        }
        
        .stat-label {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: var(--text-secondary);
            margin-top: 4px;
        }
        
        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 16px 24px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            opacity: 0;
            transition: all 0.4s ease;
            z-index: 1000;
        }
        
        .notification.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }
        
        .notification-text {
            font-weight: 500;
            font-size: 14px;
        }
        
        /* Scroll to top button */
        .scroll-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 56px;
            height: 56px;
            background: var(--focus-red);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 8px 24px rgba(230, 57, 70, 0.4);
            transition: all 0.3s ease;
            z-index: 1000;
            opacity: 0;
            transform: scale(0);
        }
        
        .scroll-btn.visible {
            opacity: 1;
            transform: scale(1);
        }
        
        .scroll-btn:hover {
            background: #d62839;
            transform: scale(1.1);
            box-shadow: 0 12px 32px rgba(230, 57, 70, 0.6);
        }
        
        .scroll-btn:active {
            transform: scale(0.95);
        }
        
        .scroll-btn svg {
            width: 24px;
            height: 24px;
            fill: white;
        }
        
        /* Checklist Section */
        .checklist-section {
            margin-top: 20px;
            animation: fadeIn 1s ease 0.6s both;
        }
        
        .checklist-card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 20px;
        }
        
        .checklist-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .checklist-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 24px;
            letter-spacing: 2px;
            color: var(--focus-red);
        }
        
        .add-task-form {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .task-input {
            flex: 1;
            padding: 14px 18px;
            background: var(--dark-bg);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            color: var(--text-primary);
            font-family: 'DM Sans', sans-serif;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .task-input:focus {
            outline: none;
            border-color: var(--focus-red);
            box-shadow: 0 0 0 3px rgba(230, 57, 70, 0.1);
        }
        
        .task-input::placeholder {
            color: var(--text-secondary);
        }
        
        .subject-input {
            width: 140px;
            padding: 14px 18px;
            background: var(--dark-bg);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            color: var(--text-primary);
            font-family: 'DM Sans', sans-serif;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .subject-input:focus {
            outline: none;
            border-color: var(--break-green);
            box-shadow: 0 0 0 3px rgba(6, 255, 165, 0.1);
        }
        
        .add-btn {
            padding: 14px 24px;
            background: var(--focus-red);
            border: none;
            border-radius: 10px;
            color: white;
            font-family: 'DM Sans', sans-serif;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
        }
        
        .add-btn:hover {
            background: #d62839;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(230, 57, 70, 0.4);
        }
        
        .add-btn:active {
            transform: translateY(0);
        }
        
        .tasks-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .task-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px;
            background: var(--dark-bg);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            transition: all 0.3s ease;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .task-item:hover {
            border-color: var(--focus-red);
            transform: translateX(4px);
        }
        
        .task-item.completed {
            opacity: 0.6;
        }
        
        .task-item.completed .task-text {
            text-decoration: line-through;
            color: var(--text-secondary);
        }
        
        .task-checkbox {
            width: 22px;
            height: 22px;
            min-width: 22px;
            border: 2px solid var(--border-color);
            border-radius: 6px;
            cursor: pointer;
            position: relative;
            transition: all 0.2s ease;
        }
        
        .task-checkbox:hover {
            border-color: var(--focus-red);
        }
        
        .task-checkbox.checked {
            background: var(--focus-red);
            border-color: var(--focus-red);
        }
        
        .task-checkbox.checked::after {
            content: 'âœ“';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 14px;
            font-weight: bold;
        }
        
        .task-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        
        .task-text {
            color: var(--text-primary);
            font-size: 15px;
            line-height: 1.4;
        }
        
        .task-subject {
            display: inline-block;
            padding: 4px 12px;
            background: rgba(230, 57, 70, 0.2);
            color: var(--focus-red);
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-radius: 6px;
            width: fit-content;
        }
        
        .delete-btn {
            padding: 8px 12px;
            background: transparent;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-secondary);
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
        }
        
        .delete-btn:hover {
            background: rgba(230, 57, 70, 0.1);
            border-color: var(--focus-red);
            color: var(--focus-red);
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-secondary);
            font-size: 14px;
        }
        
        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 12px;
            opacity: 0.5;
        }
        
        /* Daily Progress Checklist */
        .daily-progress-section {
            animation: fadeIn 1.2s ease 0.8s both;
        }
        
        .daily-progress-card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 24px;
            padding: 30px;
            height: 100%;
            display: flex;
            flex-direction: column;
            max-height: 600px;
        }
        
        .daily-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            background: var(--card-bg);
            z-index: 10;
        }
        
        .daily-title-section {
            flex: 1;
        }
        
        .daily-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 24px;
            letter-spacing: 2px;
            color: var(--break-green);
            margin-bottom: 4px;
        }
        
        .daily-date {
            font-size: 11px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .daily-header-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .reset-goals-btn {
            padding: 8px 14px;
            background: transparent;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-secondary);
            font-family: 'DM Sans', sans-serif;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
        }
        
        .reset-goals-btn:hover {
            background: rgba(6, 255, 165, 0.1);
            border-color: var(--break-green);
            color: var(--break-green);
        }
        
        .daily-stats {
            text-align: right;
        }
        
        .daily-progress-percentage {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 32px;
            color: var(--break-green);
            letter-spacing: 1px;
        }
        
        .daily-progress-label {
            font-size: 11px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .daily-items-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 20px;
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding-right: 8px;
        }
        
        /* Custom scrollbar for daily items list */
        .daily-items-list::-webkit-scrollbar {
            width: 6px;
        }
        
        .daily-items-list::-webkit-scrollbar-track {
            background: rgba(139, 148, 158, 0.1);
            border-radius: 3px;
        }
        
        .daily-items-list::-webkit-scrollbar-thumb {
            background: rgba(139, 148, 158, 0.3);
            border-radius: 3px;
        }
        
        .daily-items-list::-webkit-scrollbar-thumb:hover {
            background: rgba(139, 148, 158, 0.5);
        }
        
        /* Firefox scrollbar */
        .daily-items-list {
            scrollbar-width: thin;
            scrollbar-color: rgba(139, 148, 158, 0.3) rgba(139, 148, 158, 0.1);
        }
        
        .daily-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 14px;
            background: var(--dark-bg);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .daily-item:hover {
            border-color: var(--break-green);
            transform: translateX(4px);
        }
        
        .daily-item.completed {
            background: rgba(6, 255, 165, 0.05);
            border-color: var(--break-green);
        }
        
        .daily-item.completed .daily-item-text {
            color: var(--break-green);
            font-weight: 600;
        }
        
        .daily-checkbox {
            width: 24px;
            height: 24px;
            min-width: 24px;
            border: 2px solid var(--border-color);
            border-radius: 50%;
            position: relative;
            transition: all 0.3s ease;
        }
        
        .daily-item:hover .daily-checkbox {
            border-color: var(--break-green);
        }
        
        .daily-checkbox.checked {
            background: var(--break-green);
            border-color: var(--break-green);
            animation: checkPop 0.3s ease;
        }
        
        @keyframes checkPop {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        
        .daily-checkbox.checked::after {
            content: 'âœ“';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: var(--dark-bg);
            font-size: 14px;
            font-weight: bold;
        }
        
        .daily-item-content {
            flex: 1;
        }
        
        .daily-item-text {
            color: var(--text-primary);
            font-size: 14px;
            line-height: 1.4;
            transition: all 0.3s ease;
        }
        
        .daily-item-emoji {
            font-size: 18px;
            margin-right: 4px;
        }
        
        .goal-category-badge {
            display: inline-block;
            padding: 2px 8px;
            background: rgba(139, 148, 158, 0.2);
            color: var(--text-secondary);
            font-size: 9px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-radius: 4px;
            margin-left: 8px;
        }
        
        .goal-category-badge.study {
            background: rgba(230, 57, 70, 0.2);
            color: var(--focus-red);
        }
        
        .goal-category-badge.health {
            background: rgba(6, 255, 165, 0.2);
            color: var(--break-green);
        }
        
        .goal-category-badge.focus {
            background: rgba(76, 201, 240, 0.2);
            color: var(--long-break-blue);
        }
        
        .lifetime-badge {
            display: inline-block;
            padding: 2px 8px;
            background: linear-gradient(135deg, rgba(230, 57, 70, 0.3), rgba(6, 255, 165, 0.3));
            color: var(--text-primary);
            font-size: 9px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-radius: 4px;
            margin-left: 6px;
            border: 1px solid rgba(6, 255, 165, 0.4);
        }
        
        /* Completed Tasks Section */
        .completed-tasks-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }
        
        .completed-tasks-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            padding: 12px;
            background: rgba(139, 148, 158, 0.05);
            border-radius: 8px;
            margin-bottom: 12px;
            transition: all 0.2s ease;
        }
        
        .completed-tasks-header:hover {
            background: rgba(139, 148, 158, 0.1);
        }
        
        .completed-tasks-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .completed-count {
            font-size: 11px;
            color: var(--text-secondary);
            background: rgba(139, 148, 158, 0.2);
            padding: 3px 10px;
            border-radius: 12px;
        }
        
        .toggle-icon {
            font-size: 12px;
            color: var(--text-secondary);
            transition: transform 0.3s ease;
        }
        
        .toggle-icon.expanded {
            transform: rotate(180deg);
        }
        
        .completed-tasks-list {
            display: none;
            flex-direction: column;
            gap: 8px;
            max-height: 200px;
            overflow-y: auto;
            padding-right: 8px;
        }
        
        .completed-tasks-list.show {
            display: flex;
        }
        
        /* Custom scrollbar for completed tasks */
        .completed-tasks-list::-webkit-scrollbar {
            width: 6px;
        }
        
        .completed-tasks-list::-webkit-scrollbar-track {
            background: rgba(139, 148, 158, 0.1);
            border-radius: 3px;
        }
        
        .completed-tasks-list::-webkit-scrollbar-thumb {
            background: rgba(139, 148, 158, 0.3);
            border-radius: 3px;
        }
        
        .completed-tasks-list::-webkit-scrollbar-thumb:hover {
            background: rgba(139, 148, 158, 0.5);
        }
        
        .completed-tasks-list {
            scrollbar-width: thin;
            scrollbar-color: rgba(139, 148, 158, 0.3) rgba(139, 148, 158, 0.1);
        }
        
        .completed-task-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 14px;
            background: rgba(139, 148, 158, 0.05);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            opacity: 0.7;
        }
        
        .completed-task-text {
            flex: 1;
            color: var(--text-secondary);
            font-size: 14px;
            text-decoration: line-through;
        }
        
        .clear-completed-btn {
            padding: 8px 14px;
            background: transparent;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-secondary);
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .clear-completed-btn:hover {
            background: rgba(230, 57, 70, 0.1);
            border-color: var(--focus-red);
            color: var(--focus-red);
        }
        
        /* Daily Progress Card */
        .daily-progress-ring-card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 24px;
            padding: 25px;
            margin-bottom: 20px;
            animation: fadeIn 0.8s ease 0.4s both;
        }
        
        .progress-ring-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .progress-ring-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 20px;
            letter-spacing: 2px;
            color: var(--focus-red);
        }
        
        .edit-goal-btn {
            padding: 6px 10px;
            background: transparent;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-secondary);
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .edit-goal-btn:hover {
            background: rgba(230, 57, 70, 0.1);
            border-color: var(--focus-red);
            color: var(--focus-red);
        }
        
        .progress-ring-content {
            display: flex;
            gap: 25px;
            align-items: center;
        }
        
        .progress-ring-container {
            position: relative;
            width: 140px;
            height: 140px;
            flex-shrink: 0;
        }
        
        .progress-ring-container svg {
            transform: rotate(-90deg);
            width: 100%;
            height: 100%;
        }
        
        .progress-ring-bg {
            fill: none;
            stroke: rgba(139, 148, 158, 0.2);
            stroke-width: 10;
        }
        
        .progress-ring-fill {
            fill: none;
            stroke: var(--focus-red);
            stroke-width: 10;
            stroke-linecap: round;
            transition: stroke-dashoffset 0.5s ease;
        }
        
        .progress-ring-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }
        
        .progress-ring-time {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 24px;
            color: var(--focus-red);
            letter-spacing: 1px;
            line-height: 1;
        }
        
        .progress-ring-label {
            font-size: 10px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 4px;
        }
        
        .progress-stats {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .progress-stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 12px;
            background: rgba(139, 148, 158, 0.05);
            border-radius: 8px;
        }
        
        .progress-stat-label {
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .progress-stat-value {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 18px;
            color: var(--text-primary);
            letter-spacing: 1px;
        }
        
        .streak-value {
            color: var(--break-green);
        }
        
        .progress-goal-display {
            font-size: 11px;
            color: var(--text-secondary);
            text-align: center;
            margin-top: 8px;
        }
        
        /* Goal Edit Modal */
        .goal-modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 10000;
            align-items: center;
            justify-content: center;
        }
        
        .goal-modal-overlay.active {
            display: flex;
        }
        
        .goal-modal {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 30px;
            max-width: 400px;
            width: 90%;
        }
        
        .goal-modal-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 24px;
            letter-spacing: 2px;
            color: var(--focus-red);
            margin-bottom: 20px;
        }
        
        .goal-input-group {
            margin-bottom: 20px;
        }
        
        .goal-input-label {
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
            display: block;
        }
        
        .goal-input {
            width: 100%;
            padding: 12px 16px;
            background: var(--dark-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-family: 'DM Sans', sans-serif;
            font-size: 16px;
        }
        
        .goal-input:focus {
            outline: none;
            border-color: var(--focus-red);
            box-shadow: 0 0 0 3px rgba(230, 57, 70, 0.1);
        }
        
        .goal-modal-actions {
            display: flex;
            gap: 12px;
            margin-top: 25px;
        }
        
        .goal-modal-actions .btn {
            flex: 1;
        }
        
        /* Consistency Heatmap Card */
        .consistency-card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 25px;
            margin-top: 20px;
            animation: fadeIn 1s ease 0.6s both;
            width: 100%;
        }
        
        .consistency-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .consistency-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 18px;
            letter-spacing: 2px;
            color: var(--break-green);
        }
        
        .current-streak {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 16px;
            color: var(--text-primary);
            letter-spacing: 1px;
        }
        
        .heatmap-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 6px;
            margin-bottom: 10px;
        }
        
        .heatmap-day {
            aspect-ratio: 1;
            background: rgba(139, 148, 158, 0.1);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            transition: all 0.3s ease;
        }
        
        .heatmap-day.completed {
            background: var(--break-green);
            border-color: var(--break-green);
            box-shadow: 0 0 8px rgba(6, 255, 165, 0.4);
            animation: glowPulse 2s ease-in-out infinite;
        }
        
        @keyframes glowPulse {
            0%, 100% { box-shadow: 0 0 8px rgba(6, 255, 165, 0.4); }
            50% { box-shadow: 0 0 12px rgba(6, 255, 165, 0.6); }
        }
        
        .heatmap-day.today {
            border: 2px solid var(--break-green);
        }
        
        .heatmap-labels {
            display: flex;
            justify-content: space-between;
            font-size: 9px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 8px;
        }
        
        /* RPG Leveling System Card */
        .rpg-level-card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 25px;
            margin-top: 20px;
            animation: fadeIn 1.2s ease 0.8s both;
            width: 100%;
        }
        
        .rpg-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .rpg-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 18px;
            letter-spacing: 2px;
            color: var(--focus-red);
        }
        
        .rpg-level {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 24px;
            color: var(--break-green);
            letter-spacing: 1px;
        }
        
        .rpg-rank-name {
            font-size: 14px;
            color: var(--text-primary);
            margin-bottom: 15px;
            font-weight: 600;
        }
        
        .rpg-rank-icon {
            font-size: 20px;
            margin-right: 8px;
        }
        
        .xp-bar-container {
            margin-bottom: 10px;
        }
        
        .xp-bar {
            width: 100%;
            height: 12px;
            background: rgba(139, 148, 158, 0.2);
            border-radius: 6px;
            overflow: hidden;
            position: relative;
        }
        
        .xp-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--focus-red), var(--break-green));
            border-radius: 6px;
            transition: width 0.5s ease;
            box-shadow: 0 0 10px rgba(6, 255, 165, 0.5);
            position: relative;
        }
        
        .xp-bar-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .xp-text {
            display: flex;
            justify-content: space-between;
            font-size: 11px;
            color: var(--text-secondary);
            margin-top: 6px;
        }
        
        .level-up-notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: var(--card-bg);
            border: 2px solid var(--break-green);
            border-radius: 16px;
            padding: 40px 50px;
            text-align: center;
            z-index: 10001;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            opacity: 0;
            transition: all 0.4s ease;
        }
        
        .level-up-notification.show {
            transform: translate(-50%, -50%) scale(1);
            opacity: 1;
        }
        
        .level-up-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 48px;
            color: var(--break-green);
            letter-spacing: 4px;
            margin-bottom: 10px;
            text-shadow: 0 0 20px rgba(6, 255, 165, 0.6);
        }
        
        .level-up-rank {
            font-size: 24px;
            color: var(--text-primary);
            font-weight: 600;
            margin-top: 10px;
        }
        
        /* Backup & Restore Section */
        .backup-section {
            margin-top: 40px;
            padding: 30px;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            animation: fadeIn 1.8s ease 1.2s both;
        }
        
        .backup-header {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 20px;
            letter-spacing: 2px;
            color: var(--long-break-blue);
            margin-bottom: 15px;
        }
        
        .backup-description {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 20px;
        }
        
        .backup-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }
        
        .backup-btn {
            padding: 12px 20px;
            background: transparent;
            border: 1px solid var(--border-color);
            border-radius: 10px;
            color: var(--text-primary);
            font-family: 'DM Sans', sans-serif;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .backup-btn:hover {
            background: rgba(76, 201, 240, 0.1);
            border-color: var(--long-break-blue);
            color: var(--long-break-blue);
            transform: translateY(-2px);
        }
        
        .backup-btn.restore {
            border-color: var(--break-green);
            color: var(--break-green);
        }
        
        .backup-btn.restore:hover {
            background: rgba(6, 255, 165, 0.1);
            border-color: var(--break-green);
        }
        
        .restore-file-input {
            display: none;
        }
        
        .backup-info {
            font-size: 11px;
            color: var(--text-secondary);
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
        }
        
        /* Music Hub Card */
        .spotify-card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 25px;
            margin-top: 20px;
            animation: fadeIn 1.4s ease 1s both;
            width: 100%;
        }
        
        .spotify-header {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            gap: 10px;
        }
        
        .spotify-logo-big {
            font-size: 32px;
        }
        
        .spotify-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 24px;
            letter-spacing: 2px;
            color: var(--break-green);
        }
        
        .sync-reminder {
            display: none;
            padding: 6px 12px;
            background: rgba(6, 255, 165, 0.1);
            border: 1px solid var(--break-green);
            border-radius: 6px;
            font-size: 10px;
            color: var(--break-green);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 10px;
            text-align: center;
            animation: pulse 2s ease-in-out infinite;
        }
        
        .sync-reminder.show {
            display: block;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }
        
        .music-links {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .music-link {
            display: flex;
            align-items: center;
            padding: 16px 18px;
            background: linear-gradient(135deg, rgba(139, 148, 158, 0.05), rgba(6, 255, 165, 0.05));
            border: 1px solid var(--border-color);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            color: var(--text-primary);
            font-size: 14px;
            font-weight: 600;
            position: relative;
            overflow: hidden;
        }
        
        .music-link::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(6, 255, 165, 0.1), transparent);
            transition: left 0.5s ease;
        }
        
        .music-link:hover::before {
            left: 100%;
        }
        
        .music-link:hover {
            background: linear-gradient(135deg, rgba(6, 255, 165, 0.1), rgba(76, 201, 240, 0.1));
            border-color: var(--break-green);
            transform: translateX(4px);
            box-shadow: 0 4px 12px rgba(6, 255, 165, 0.2);
        }
        
        .music-link-icon {
            font-size: 24px;
            margin-right: 12px;
        }
        
        .music-link-text {
            flex: 1;
        }
        
        .music-link-arrow {
            font-size: 16px;
            color: var(--text-secondary);
            transition: all 0.3s ease;
        }
        
        .music-link:hover .music-link-arrow {
            color: var(--break-green);
            transform: translateX(4px);
        }
        
        .music-subtitle {
            font-size: 11px;
            color: var(--text-secondary);
            text-align: center;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        /* Ambient Audio Mixer */
        .soundscape-mixer {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 25px;
            margin-top: 20px;
            animation: fadeIn 1.6s ease 1.2s both;
            width: 100%;
        }
        
        .mixer-header {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            gap: 10px;
        }
        
        .mixer-logo {
            font-size: 28px;
        }
        
        .mixer-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 24px;
            letter-spacing: 2px;
            color: var(--break-green);
        }
        
        .sound-cards {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }
        
        .sound-card {
            background: linear-gradient(135deg, rgba(139, 148, 158, 0.05), rgba(6, 255, 165, 0.05));
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 16px;
            transition: all 0.3s ease;
        }
        
        .sound-card:hover {
            border-color: var(--break-green);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(6, 255, 165, 0.2);
        }
        
        .sound-card.playing {
            background: linear-gradient(135deg, rgba(6, 255, 165, 0.1), rgba(76, 201, 240, 0.1));
            border-color: var(--break-green);
        }
        
        .sound-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }
        
        .sound-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .sound-icon {
            font-size: 24px;
        }
        
        .sound-name {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .play-pause-btn {
            width: 36px;
            height: 36px;
            background: transparent;
            border: 2px solid var(--border-color);
            border-radius: 50%;
            color: var(--text-secondary);
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .play-pause-btn:hover {
            border-color: var(--break-green);
            color: var(--break-green);
            transform: scale(1.1);
        }
        
        .play-pause-btn.playing {
            background: var(--break-green);
            border-color: var(--break-green);
            color: var(--dark-bg);
        }
        
        .volume-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .volume-icon {
            font-size: 14px;
            color: var(--text-secondary);
        }
        
        .volume-slider {
            flex: 1;
            height: 6px;
            -webkit-appearance: none;
            appearance: none;
            background: rgba(139, 148, 158, 0.2);
            border-radius: 3px;
            outline: none;
        }
        
        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            background: var(--break-green);
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .volume-slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 0 8px rgba(6, 255, 165, 0.6);
        }
        
        .volume-slider::-moz-range-thumb {
            width: 16px;
            height: 16px;
            background: var(--break-green);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .volume-slider::-moz-range-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 0 8px rgba(6, 255, 165, 0.6);
        }
        
        .volume-value {
            font-size: 11px;
            color: var(--text-secondary);
            min-width: 30px;
            text-align: right;
        }
        
        .mixer-footer {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
            text-align: center;
            font-size: 11px;
            color: var(--text-secondary);
        }
        
        .daily-progress-bar-container {
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
            position: sticky;
            bottom: 0;
            background: var(--card-bg);
            z-index: 10;
        }
        
        .daily-progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(139, 148, 158, 0.2);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 10px;
        }
        
        .daily-progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--break-green), var(--long-break-blue));
            border-radius: 4px;
            transition: width 0.5s ease;
            box-shadow: 0 0 10px rgba(6, 255, 165, 0.5);
        }
        
        .daily-progress-text {
            text-align: center;
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        .daily-complete-celebration {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, rgba(6, 255, 165, 0.1), rgba(76, 201, 240, 0.1));
            border-radius: 10px;
            margin-top: 15px;
            animation: celebration 0.6s ease;
        }
        
        @keyframes celebration {
            0%, 100% { transform: scale(1); }
            25% { transform: scale(1.05); }
            75% { transform: scale(0.95); }
        }
        
        .daily-complete-celebration-emoji {
            font-size: 48px;
            margin-bottom: 10px;
            animation: bounce 1s ease infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .daily-complete-celebration-text {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 20px;
            letter-spacing: 2px;
            color: var(--break-green);
        }
        
        /* Mobile responsive */
        @media (max-width: 480px) {
            .app-title {
                font-size: 40px;
            }
            
            .time {
                font-size: 72px;
            }
            
            .timer-card {
                padding: 30px 20px;
            }
            
            .add-task-form {
                flex-direction: column;
            }
            
            .subject-input {
                width: 100%;
            }
            
            .task-item {
                flex-wrap: wrap;
            }
            
            .delete-btn {
                margin-left: auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="app-header">
            <img src="logo.png" alt="Focus Flow Logo">
            <h1 class="app-title">FOCUS FLOW</h1>
            <p class="app-subtitle">Pomodoro Study Timer</p>
        </header>
        
        <div class="dashboard-container">
            
            <!-- GOALS AREA (Left Column) -->
            <div class="goals-area">
                <!-- Today's Goals Card -->
                <div class="daily-progress-card">
                    <div class="daily-header">
                        <div class="daily-title-section">
                            <h2 class="daily-title">Today's Goals</h2>
                            <p class="daily-date" id="dailyDate">Today's Date</p>
                        </div>
                        <div class="daily-header-actions">
                            <button class="reset-goals-btn" id="resetGoalsBtn">â†» Reset</button>
                            <div class="daily-stats">
                                <div class="daily-progress-percentage" id="dailyPercentage">0%</div>
                                <div class="daily-progress-label">Done</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="daily-items-list" id="dailyItemsList">
                        <!-- Daily items will be rendered here -->
                    </div>
                    
                    <div class="daily-progress-bar-container">
                        <div class="daily-progress-bar">
                            <div class="daily-progress-bar-fill" id="dailyProgressBarFill" style="width: 0%"></div>
                        </div>
                        <div class="daily-progress-text" id="dailyProgressText">0 of 5 goals completed</div>
                    </div>
                    
                    <div id="dailyCelebration"></div>
                    
                    <!-- Completed Tasks Section -->
                    <div class="completed-tasks-section" id="completedTasksSection" style="display: none;">
                        <div class="completed-tasks-header" id="completedTasksHeader">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span class="completed-tasks-title">Completed Tasks</span>
                                <span class="completed-count" id="completedCount">0</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <button class="clear-completed-btn" id="clearCompletedBtn">Clear All</button>
                                <span class="toggle-icon" id="toggleIcon">â–¼</span>
                            </div>
                        </div>
                        <div class="completed-tasks-list" id="completedTasksList">
                            <!-- Completed tasks will appear here -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- TIMER AREA (Center Top) -->
            <div class="timer-area">
                <!-- Timer Section -->
                <div class="timer-card" id="timerCard">
                    <button class="fullscreen-btn" id="fullscreenBtn" title="Enter Fullscreen">â›¶</button>
                    
                    <div class="mode-indicator">
                        <div class="mode-label">Current Session</div>
                        <div class="mode-name focus" id="modeName">FOCUS TIME</div>
                    </div>
                    
                    <div class="timer-display">
                        <div class="circular-timer">
                            <svg viewBox="0 0 200 200">
                                <circle class="circular-timer-bg" cx="100" cy="100" r="90"></circle>
                                <circle class="circular-timer-progress" id="circularProgress" cx="100" cy="100" r="90"></circle>
                            </svg>
                            <div class="timer-content">
                                <div class="time focus" id="timeDisplay">25:00</div>
                                <div class="timer-mode-label" id="timerModeLabel">Focus Session</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                    </div>
                    
                    <div class="controls">
                        <button class="btn btn-primary" id="startBtn">Start</button>
                        <button class="btn btn-secondary" id="resetBtn">Reset</button>
                    </div>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="sessionsCompleted">0</div>
                        <div class="stat-label">Sessions</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalMinutes">0</div>
                        <div class="stat-label">Minutes</div>
                    </div>
                </div>
                
                <!-- Music Hub -->
                <div class="spotify-card">
                    <div class="spotify-header">
                        <span class="spotify-logo-big">ðŸŽµ</span>
                        <h3 class="spotify-title">Focus Soundtrack</h3>
                    </div>
                    <div class="music-subtitle">Click to open in Spotify</div>
                    <div class="music-links">
                        <a href="https://open.spotify.com/playlist/37i9dQZF1DWZeKCadgRdKQ" target="_blank" rel="noopener noreferrer" class="music-link">
                            <span class="music-link-icon">ðŸŽ§</span>
                            <span class="music-link-text">Deep Focus Playlist</span>
                            <span class="music-link-arrow">â†’</span>
                        </a>
                        <a href="https://open.spotify.com/playlist/37i9dQZF1DWWQRwui0ExPn" target="_blank" rel="noopener noreferrer" class="music-link">
                            <span class="music-link-icon">â˜•</span>
                            <span class="music-link-text">Lofi Study Beats</span>
                            <span class="music-link-arrow">â†’</span>
                        </a>
                        <a href="https://open.spotify.com/playlist/37i9dQZF1DX4sWSpwq3LiO" target="_blank" rel="noopener noreferrer" class="music-link">
                            <span class="music-link-icon">ðŸŒ§ï¸</span>
                            <span class="music-link-text">Ambient Nature</span>
                            <span class="music-link-arrow">â†’</span>
                        </a>
                    </div>
                    <div class="sync-reminder" id="syncReminder">ðŸŽ§ Start your focus music!</div>
                </div>
                
                <!-- Consistency Heatmap -->
                <div class="consistency-card">
                    <div class="consistency-header">
                        <h3 class="consistency-title">Consistency</h3>
                        <div class="current-streak" id="heatmapStreak">0 ðŸ”¥</div>
                    </div>
                    <div class="heatmap-grid" id="heatmapGrid">
                        <!-- 28 days (7x4 grid) will be generated here -->
                    </div>
                    <div class="heatmap-labels">
                        <span>4 weeks ago</span>
                        <span>Today</span>
                    </div>
                </div>
                
                <!-- RPG Leveling System -->
                <div class="rpg-level-card">
                    <div class="rpg-header">
                        <h3 class="rpg-title">Focus Rank</h3>
                        <div class="rpg-level" id="rpgLevel">Level 1</div>
                    </div>
                    <div class="rpg-rank-name" id="rpgRankName">
                        <span class="rpg-rank-icon">ðŸŒ±</span>The Novice
                    </div>
                    <div class="xp-bar-container">
                        <div class="xp-bar">
                            <div class="xp-bar-fill" id="xpBarFill" style="width: 0%"></div>
                        </div>
                        <div class="xp-text">
                            <span id="xpCurrent">0 min</span>
                            <span id="xpNext">60 min to Level 2</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- PROGRESS AREA (Right Column) -->
            <div class="progress-area">
                <!-- Daily Progress Ring Card -->
                <div class="daily-progress-ring-card">
                    <div class="progress-ring-header">
                        <h3 class="progress-ring-title">Daily Progress</h3>
                        <button class="edit-goal-btn" id="editGoalBtn" title="Edit daily goal">âœï¸</button>
                    </div>
                    
                    <div class="progress-ring-content">
                        <div class="progress-ring-container">
                            <svg viewBox="0 0 140 140">
                                <circle class="progress-ring-bg" cx="70" cy="70" r="60"></circle>
                                <circle class="progress-ring-fill" id="progressRingFill" cx="70" cy="70" r="60"></circle>
                            </svg>
                            <div class="progress-ring-text">
                                <div class="progress-ring-time" id="studyTimeDisplay">0:00</div>
                                <div class="progress-ring-label">Studied</div>
                            </div>
                        </div>
                        
                        <div class="progress-stats">
                            <div class="progress-stat-item">
                                <span class="progress-stat-label">Yesterday</span>
                                <span class="progress-stat-value" id="yesterdayTotal">0:00</span>
                            </div>
                            <div class="progress-stat-item">
                                <span class="progress-stat-label">Day Streak</span>
                                <span class="progress-stat-value streak-value" id="dayStreak">0 ðŸ”¥</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="progress-goal-display" id="goalDisplay">Goal: 4 hours</div>
                </div>
            </div>
            
            <!-- AUDIO AREA (Center Bottom) -->
            <div class="audio-area">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <!-- Soundscape Mixer -->
                    <div class="soundscape-mixer">
                    <div class="mixer-header">
                        <span class="mixer-logo">ðŸŽ§</span>
                        <h3 class="mixer-title">Soundscape Mixer</h3>
                    </div>
                    
                    <div class="sound-cards">
                        <!-- Rain Sound -->
                        <div class="sound-card" id="rain-card">
                            <div class="sound-header">
                                <div class="sound-info">
                                    <span class="sound-icon">ðŸŒ§ï¸</span>
                                    <span class="sound-name">Rain</span>
                                </div>
                                <button class="play-pause-btn" id="rain-play" data-sound="rain">â–¶</button>
                            </div>
                            <div class="volume-control">
                                <span class="volume-icon">ðŸ”Š</span>
                                <input type="range" class="volume-slider" id="rain-volume" min="0" max="100" value="70">
                                <span class="volume-value" id="rain-value">70%</span>
                            </div>
                        </div>
                        
                        <!-- Forest Sound -->
                        <div class="sound-card" id="forest-card">
                            <div class="sound-header">
                                <div class="sound-info">
                                    <span class="sound-icon">ðŸŒ²</span>
                                    <span class="sound-name">Forest</span>
                                </div>
                                <button class="play-pause-btn" id="forest-play" data-sound="forest">â–¶</button>
                            </div>
                            <div class="volume-control">
                                <span class="volume-icon">ðŸ”Š</span>
                                <input type="range" class="volume-slider" id="forest-volume" min="0" max="100" value="70">
                                <span class="volume-value" id="forest-value">70%</span>
                            </div>
                        </div>
                        
                        <!-- White Noise -->
                        <div class="sound-card" id="whitenoise-card">
                            <div class="sound-header">
                                <div class="sound-info">
                                    <span class="sound-icon">âšª</span>
                                    <span class="sound-name">White Noise</span>
                                </div>
                                <button class="play-pause-btn" id="whitenoise-play" data-sound="whitenoise">â–¶</button>
                            </div>
                            <div class="volume-control">
                                <span class="volume-icon">ðŸ”Š</span>
                                <input type="range" class="volume-slider" id="whitenoise-volume" min="0" max="100" value="70">
                                <span class="volume-value" id="whitenoise-value">70%</span>
                            </div>
                        </div>
                        
                        <!-- Lo-Fi CafÃ© -->
                        <div class="sound-card" id="lofi-card">
                            <div class="sound-header">
                                <div class="sound-info">
                                    <span class="sound-icon">â˜•</span>
                                    <span class="sound-name">Lo-Fi CafÃ©</span>
                                </div>
                                <button class="play-pause-btn" id="lofi-play" data-sound="lofi">â–¶</button>
                            </div>
                            <div class="volume-control">
                                <span class="volume-icon">ðŸ”Š</span>
                                <input type="range" class="volume-slider" id="lofi-volume" min="0" max="100" value="70">
                                <span class="volume-value" id="lofi-value">70%</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mixer-footer">
                        ðŸ’¡ Mix multiple sounds for your perfect focus environment
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Checklist Section -->
        <div class="checklist-section">
            <div class="checklist-card">
                <div class="checklist-header">
                    <h2 class="checklist-title">Study Checklist</h2>
                </div>
                
                <div class="add-task-form">
                    <input 
                        type="text" 
                        class="task-input" 
                        id="taskInput" 
                        placeholder="Add a new task..."
                        maxlength="100"
                    >
                    <input 
                        type="text" 
                        class="subject-input" 
                        id="subjectInput" 
                        placeholder="Subject"
                        maxlength="20"
                    >
                    <button class="add-btn" id="addTaskBtn">+ Add</button>
                </div>
                
                <div class="tasks-list" id="tasksList">
                    <div class="empty-state">
                        <div class="empty-state-icon">ðŸ“</div>
                        <p>No tasks yet. Add your first study task above!</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div style="margin-top: 40px; padding: 30px; background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 16px; animation: fadeIn 1.2s ease 0.6s both;">
            <h3 style="font-family: 'Bebas Neue', sans-serif; font-size: 24px; letter-spacing: 2px; color: var(--focus-red); margin-bottom: 16px;">HOW TO USE</h3>
            <div style="color: var(--text-secondary); line-height: 1.8; font-size: 14px;">
                <p style="margin-bottom: 12px;"><strong style="color: var(--text-primary);">1. Focus Session (25 min):</strong> Eliminate distractions and work on a single task.</p>
                <p style="margin-bottom: 12px;"><strong style="color: var(--text-primary);">2. Short Break (5 min):</strong> Stretch, grab water, rest your eyes.</p>
                <p style="margin-bottom: 12px;"><strong style="color: var(--text-primary);">3. Repeat:</strong> After 4 sessions, take a longer 15-minute break.</p>
                <p style="margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border-color);"><strong style="color: var(--text-primary);">ðŸ’¡ Pro Tip:</strong> During focus time, turn off notifications, close unnecessary tabs, and commit fully to your study task.</p>
            </div>
        </div>
        
        <div style="margin-top: 20px; padding: 30px; background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 16px; animation: fadeIn 1.4s ease 0.8s both;">
            <h3 style="font-family: 'Bebas Neue', sans-serif; font-size: 24px; letter-spacing: 2px; color: var(--break-green); margin-bottom: 16px;">STUDY TIPS</h3>
            <div style="color: var(--text-secondary); line-height: 1.8; font-size: 14px;">
                <p style="margin-bottom: 12px;">ðŸ“š Break large tasks into 25-minute chunks</p>
                <p style="margin-bottom: 12px;">ðŸŽ¯ Focus on one subject at a time</p>
                <p style="margin-bottom: 12px;">ðŸ’§ Stay hydrated during breaks</p>
                <p style="margin-bottom: 12px;">ðŸ§˜ Use breaks for physical movement</p>
                <p>âœ… Track your progress and celebrate wins</p>
            </div>
        </div>
        
        <!-- Backup & Restore Section -->
        <div class="backup-section">
            <h3 class="backup-header">Backup & Restore</h3>
            <p class="backup-description">
                Download your complete study history, progress, and level data to keep it safe. 
                You can restore this data anytime if you switch devices or browsers.
            </p>
            <div class="backup-actions">
                <button class="backup-btn" id="downloadBackupBtn">
                    <span>ðŸ’¾</span>
                    Download Backup
                </button>
                <button class="backup-btn restore" id="restoreBackupBtn">
                    <span>ðŸ“¥</span>
                    Restore from File
                </button>
                <input type="file" class="restore-file-input" id="restoreFileInput" accept=".json">
            </div>
            <div class="backup-info">
                ðŸ’¡ Your backup includes: Study time, level progress, daily goals history, completed tasks, heatmap data, and streak information.
            </div>
        </div>
        
        <div style="margin: 40px 0 20px; text-align: center; color: var(--text-secondary); font-size: 12px; animation: fadeIn 1.6s ease 1s both;">
            Made with focus ðŸŽ¯ | Pomodoro Technique
        </div>
    </div>
    
    <div class="notification" id="notification">
        <div class="notification-text" id="notificationText"></div>
    </div>
    
    <button class="scroll-btn" id="scrollBtn" aria-label="Scroll to top">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 4l-8 8h5v8h6v-8h5z"/>
        </svg>
    </button>
    
    <!-- Fullscreen Overlay -->
    <div class="fullscreen-overlay" id="fullscreenOverlay">
        <button class="exit-fullscreen-btn" id="exitFullscreenBtn">Exit Fullscreen</button>
        
        <div class="fullscreen-content">
            <div class="fullscreen-mode-name focus" id="fullscreenModeName">FOCUS TIME</div>
            
            <div class="fullscreen-timer">
                <svg viewBox="0 0 320 320">
                    <circle class="fullscreen-timer-bg" cx="160" cy="160" r="150"></circle>
                    <circle class="fullscreen-timer-progress" id="fullscreenCircularProgress" cx="160" cy="160" r="150"></circle>
                </svg>
                <div class="fullscreen-timer-content">
                    <div class="fullscreen-time focus" id="fullscreenTimeDisplay">25:00</div>
                    <div class="fullscreen-label" id="fullscreenLabel">Focus Session</div>
                </div>
            </div>
            
            <div class="fullscreen-controls">
                <button class="btn btn-primary" id="fullscreenStartBtn">Start</button>
                <button class="btn btn-secondary" id="fullscreenResetBtn">Reset</button>
            </div>
            
            <div class="fullscreen-stats">
                <div class="fullscreen-stat">
                    <div class="fullscreen-stat-value" id="fullscreenSessions">0</div>
                    <div class="fullscreen-stat-label">Sessions Today</div>
                </div>
                <div class="fullscreen-stat">
                    <div class="fullscreen-stat-value" id="fullscreenMinutes">0</div>
                    <div class="fullscreen-stat-label">Minutes Focused</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Level Up Notification -->
    <div class="level-up-notification" id="levelUpNotification">
        <div class="level-up-title">LEVEL UP!</div>
        <div class="rpg-level" id="levelUpNumber" style="font-size: 36px;">Level 2</div>
        <div class="level-up-rank" id="levelUpRank">ðŸŒŸ The Learner</div>
    </div>
    
    <!-- Goal Edit Modal -->
    <div class="goal-modal-overlay" id="goalModalOverlay">
        <div class="goal-modal">
            <h3 class="goal-modal-title">Set Daily Study Goal</h3>
            <div class="goal-input-group">
                <label class="goal-input-label">Study Goal (Hours)</label>
                <input type="number" class="goal-input" id="goalHoursInput" min="0" max="24" step="0.5" value="4">
            </div>
            <div class="goal-modal-actions">
                <button class="btn btn-secondary" id="cancelGoalBtn">Cancel</button>
                <button class="btn btn-primary" id="saveGoalBtn">Save Goal</button>
            </div>
        </div>
    </div>

    <script>
        const FOCUS_TIME = 25 * 60; // 25 minutes in seconds
        const SHORT_BREAK = 5 * 60; // 5 minutes
        const LONG_BREAK = 15 * 60; // 15 minutes
        
        let timeLeft = FOCUS_TIME;
        let totalTime = FOCUS_TIME;
        let isRunning = false;
        let interval = null;
        let currentMode = 'focus'; // 'focus', 'break', 'long-break'
        let sessionsCount = 0;
        let totalMinutesStudied = 0;
        
        // Study progress tracking
        let dailyStudyGoalHours = parseFloat(localStorage.getItem('dailyStudyGoal')) || 4;
        let todayStudySeconds = 0;
        let studyProgressData = JSON.parse(localStorage.getItem('studyProgressData')) || {
            todayDate: getTodayKey(),
            todaySeconds: 0,
            yesterdaySeconds: 0,
            streak: 0,
            lastCompletedDate: null
        };
        
        // Session history tracking
        let sessionHistory = JSON.parse(localStorage.getItem('sessionHistory')) || [];
        
        function saveSessionHistory() {
            // Keep only last 50 sessions to avoid bloat
            if (sessionHistory.length > 50) {
                sessionHistory = sessionHistory.slice(-50);
            }
            localStorage.setItem('sessionHistory', JSON.stringify(sessionHistory));
        }
        
        function addSessionToHistory(type, duration) {
            sessionHistory.push({
                type: type, // 'focus', 'break', 'long-break'
                duration: duration,
                timestamp: Date.now(),
                date: new Date().toISOString()
            });
            saveSessionHistory();
        }
        
        // Sound effects
        function playSound(type) {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                if (type === 'tick') {
                    // Subtle tick sound
                    oscillator.frequency.value = 800;
                    gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.1);
                } else if (type === 'complete') {
                    // Success sound - three ascending tones
                    oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime); // C5
                    oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.15); // E5
                    oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.3); // G5
                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.5);
                } else if (type === 'levelup') {
                    // Level up sound - ascending arpeggio
                    oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime);
                    oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.1);
                    oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.2);
                    oscillator.frequency.setValueAtTime(1046.50, audioContext.currentTime + 0.3);
                    gainNode.gain.setValueAtTime(0.4, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.6);
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.6);
                }
            } catch (e) {
                // Silently fail if audio context not supported
                console.log('Audio not supported');
            }
        }
        
        function getTodayKey() {
            const today = new Date();
            return `${today.getFullYear()}-${today.getMonth() + 1}-${today.getDate()}`;
        }
        
        // Check if it's a new day and update progress data
        function checkNewDay() {
            const today = getTodayKey();
            if (studyProgressData.todayDate !== today) {
                // New day detected
                const goalSeconds = dailyStudyGoalHours * 3600;
                
                // Update streak and save to localStorage
                if (studyProgressData.todaySeconds >= goalSeconds) {
                    studyProgressData.streak += 1;
                    studyProgressData.lastCompletedDate = studyProgressData.todayDate;
                } else {
                    // Check if we broke the streak (missed a day)
                    const yesterday = new Date();
                    yesterday.setDate(yesterday.getDate() - 1);
                    const yesterdayKey = `${yesterday.getFullYear()}-${yesterday.getMonth() + 1}-${yesterday.getDate()}`;
                    
                    if (studyProgressData.lastCompletedDate !== yesterdayKey) {
                        studyProgressData.streak = 0;
                    }
                }
                
                // Move today's data to yesterday
                studyProgressData.yesterdaySeconds = studyProgressData.todaySeconds;
                studyProgressData.todaySeconds = 0;
                studyProgressData.todayDate = today;
                
                // Save streak and progress to localStorage
                localStorage.setItem('studyProgressData', JSON.stringify(studyProgressData));
                localStorage.setItem('currentStreak', studyProgressData.streak);
            }
            
            todayStudySeconds = studyProgressData.todaySeconds;
        }
        
        checkNewDay();
        
        function saveStudyProgress() {
            studyProgressData.todaySeconds = todayStudySeconds;
            localStorage.setItem('studyProgressData', JSON.stringify(studyProgressData));
            localStorage.setItem('currentStreak', studyProgressData.streak);
        }
        
        // RPG Level System
        let totalFocusMinutes = parseInt(localStorage.getItem('totalFocusMinutes')) || 0;
        let currentLevel = Math.floor(totalFocusMinutes / 60) + 1;
        let previousLevel = currentLevel;
        
        const rankTitles = [
            { level: 1, name: "The Novice", icon: "ðŸŒ±" },
            { level: 2, name: "The Learner", icon: "ðŸŒŸ" },
            { level: 3, name: "The Focused", icon: "ðŸŽ¯" },
            { level: 4, name: "The Dedicated", icon: "ðŸ’Ž" },
            { level: 5, name: "The Scholar", icon: "ðŸ“š" },
            { level: 7, name: "The Disciplined", icon: "âš¡" },
            { level: 10, name: "The Deep Work Master", icon: "ðŸ”¥" },
            { level: 15, name: "The Flow State King", icon: "ðŸ‘‘" },
            { level: 20, name: "The Productivity Legend", icon: "ðŸ†" },
            { level: 30, name: "The Unstoppable Force", icon: "ðŸ’ª" },
            { level: 50, name: "The Focus Immortal", icon: "âœ¨" }
        ];
        
        function getRankInfo(level) {
            for (let i = rankTitles.length - 1; i >= 0; i--) {
                if (level >= rankTitles[i].level) {
                    return rankTitles[i];
                }
            }
            return rankTitles[0];
        }
        
        function updateRPGLevel() {
            const rpgLevel = document.getElementById('rpgLevel');
            const rpgRankName = document.getElementById('rpgRankName');
            const xpBarFill = document.getElementById('xpBarFill');
            const xpCurrent = document.getElementById('xpCurrent');
            const xpNext = document.getElementById('xpNext');
            
            currentLevel = Math.floor(totalFocusMinutes / 60) + 1;
            const minutesInCurrentLevel = totalFocusMinutes % 60;
            const progressPercent = (minutesInCurrentLevel / 60) * 100;
            
            const rankInfo = getRankInfo(currentLevel);
            
            rpgLevel.textContent = `Level ${currentLevel}`;
            rpgRankName.innerHTML = `<span class="rpg-rank-icon">${rankInfo.icon}</span>${rankInfo.name}`;
            xpBarFill.style.width = `${progressPercent}%`;
            xpCurrent.textContent = `${minutesInCurrentLevel} min`;
            xpNext.textContent = `${60 - minutesInCurrentLevel} min to Level ${currentLevel + 1}`;
            
            // Check for level up
            if (currentLevel > previousLevel) {
                showLevelUpNotification(currentLevel, rankInfo);
                previousLevel = currentLevel;
            }
        }
        
        function showLevelUpNotification(level, rankInfo) {
            const levelUpNotification = document.getElementById('levelUpNotification');
            const levelUpNumber = document.getElementById('levelUpNumber');
            const levelUpRank = document.getElementById('levelUpRank');
            
            levelUpNumber.textContent = `Level ${level}`;
            levelUpRank.textContent = `${rankInfo.icon} ${rankInfo.name}`;
            
            levelUpNotification.classList.add('show');
            
            // Play level up sound
            playSound('levelup');
            
            // Save XP and level to localStorage
            localStorage.setItem('totalFocusMinutes', totalFocusMinutes);
            localStorage.setItem('currentLevel', level);
            
            // Auto-hide after 3 seconds
            setTimeout(() => {
                levelUpNotification.classList.remove('show');
            }, 3000);
        }
        
        // Heatmap data
        let heatmapData = JSON.parse(localStorage.getItem('heatmapData')) || {};
        
        function saveHeatmapData() {
            localStorage.setItem('heatmapData', JSON.stringify(heatmapData));
        }
        
        function updateHeatmap() {
            const heatmapGrid = document.getElementById('heatmapGrid');
            const heatmapStreak = document.getElementById('heatmapStreak');
            
            heatmapGrid.innerHTML = '';
            
            const today = new Date();
            const goalSeconds = dailyStudyGoalHours * 3600;
            
            // Generate 28 days
            for (let i = 27; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                const dateKey = `${date.getFullYear()}-${date.getMonth() + 1}-${date.getDate()}`;
                
                const daySquare = document.createElement('div');
                daySquare.className = 'heatmap-day';
                
                // Check if goal was completed that day
                if (heatmapData[dateKey] && heatmapData[dateKey] >= goalSeconds) {
                    daySquare.classList.add('completed');
                }
                
                // Mark today
                if (i === 0) {
                    daySquare.classList.add('today');
                    // Update today's data
                    heatmapData[dateKey] = todayStudySeconds;
                    if (todayStudySeconds >= goalSeconds) {
                        daySquare.classList.add('completed');
                    }
                }
                
                daySquare.title = dateKey;
                heatmapGrid.appendChild(daySquare);
            }
            
            saveHeatmapData();
            heatmapStreak.textContent = `${studyProgressData.streak} ðŸ”¥`;
        }
        
        function formatTimeHHMM(totalSeconds) {
            const hours = Math.floor(totalSeconds / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            if (hours > 0) {
                return `${hours}:${minutes.toString().padStart(2, '0')}`;
            }
            return `${minutes}:${(totalSeconds % 60).toString().padStart(2, '0')}`;
        }
        
        function updateProgressRing() {
            const progressRingFill = document.getElementById('progressRingFill');
            const studyTimeDisplay = document.getElementById('studyTimeDisplay');
            const goalDisplay = document.getElementById('goalDisplay');
            const yesterdayTotal = document.getElementById('yesterdayTotal');
            const dayStreak = document.getElementById('dayStreak');
            
            const goalSeconds = dailyStudyGoalHours * 3600;
            const progress = Math.min((todayStudySeconds / goalSeconds) * 100, 100);
            
            // Update circular progress
            const radius = 60;
            const circumference = 2 * Math.PI * radius;
            const offset = circumference - (progress / 100) * circumference;
            progressRingFill.style.strokeDasharray = circumference;
            progressRingFill.style.strokeDashoffset = offset;
            
            // Update displays
            studyTimeDisplay.textContent = formatTimeHHMM(todayStudySeconds);
            goalDisplay.textContent = `Goal: ${dailyStudyGoalHours} ${dailyStudyGoalHours === 1 ? 'hour' : 'hours'}`;
            yesterdayTotal.textContent = formatTimeHHMM(studyProgressData.yesterdaySeconds);
            dayStreak.textContent = `${studyProgressData.streak} ðŸ”¥`;
        }
        
        const timeDisplay = document.getElementById('timeDisplay');
        const modeName = document.getElementById('modeName');
        const timerModeLabel = document.getElementById('timerModeLabel');
        const startBtn = document.getElementById('startBtn');
        const resetBtn = document.getElementById('resetBtn');
        const progressFill = document.getElementById('progressFill');
        const circularProgress = document.getElementById('circularProgress');
        const timerCard = document.getElementById('timerCard');
        const notification = document.getElementById('notification');
        const notificationText = document.getElementById('notificationText');
        const sessionsCompleted = document.getElementById('sessionsCompleted');
        const totalMinutesEl = document.getElementById('totalMinutes');
        
        // Circular timer setup
        const radius = 90;
        const circumference = 2 * Math.PI * radius;
        circularProgress.style.strokeDasharray = circumference;
        circularProgress.style.strokeDashoffset = 0;
        
        // Fullscreen elements
        const fullscreenBtn = document.getElementById('fullscreenBtn');
        const fullscreenOverlay = document.getElementById('fullscreenOverlay');
        const exitFullscreenBtn = document.getElementById('exitFullscreenBtn');
        const fullscreenModeName = document.getElementById('fullscreenModeName');
        const fullscreenTimeDisplay = document.getElementById('fullscreenTimeDisplay');
        const fullscreenLabel = document.getElementById('fullscreenLabel');
        const fullscreenCircularProgress = document.getElementById('fullscreenCircularProgress');
        const fullscreenStartBtn = document.getElementById('fullscreenStartBtn');
        const fullscreenResetBtn = document.getElementById('fullscreenResetBtn');
        const fullscreenSessions = document.getElementById('fullscreenSessions');
        const fullscreenMinutes = document.getElementById('fullscreenMinutes');
        
        // Fullscreen circular timer setup
        const fullscreenRadius = 150;
        const fullscreenCircumference = 2 * Math.PI * fullscreenRadius;
        fullscreenCircularProgress.style.strokeDasharray = fullscreenCircumference;
        fullscreenCircularProgress.style.strokeDashoffset = 0;
        
        // Checklist elements
        const taskInput = document.getElementById('taskInput');
        const subjectInput = document.getElementById('subjectInput');
        const addTaskBtn = document.getElementById('addTaskBtn');
        const tasksList = document.getElementById('tasksList');
        
        // Load tasks from localStorage
        let tasks = JSON.parse(localStorage.getItem('studyTasks')) || [];
        
        function saveTasks() {
            localStorage.setItem('studyTasks', JSON.stringify(tasks));
        }
        
        function renderTasks() {
            if (tasks.length === 0) {
                tasksList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ðŸ“</div>
                        <p>No tasks yet. Add your first study task above!</p>
                    </div>
                `;
                return;
            }
            
            tasksList.innerHTML = tasks.map((task, index) => `
                <div class="task-item ${task.completed ? 'completed' : ''}">
                    <div class="task-checkbox ${task.completed ? 'checked' : ''}" onclick="toggleTask(${index})"></div>
                    <div class="task-content">
                        <div class="task-text">${escapeHtml(task.text)}</div>
                        <div class="task-subject">${escapeHtml(task.subject)}</div>
                    </div>
                    <button class="delete-btn" onclick="deleteTask(${index})">Delete</button>
                </div>
            `).join('');
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        function addTask() {
            const taskText = taskInput.value.trim();
            const subject = subjectInput.value.trim() || 'General';
            
            if (!taskText) {
                showNotification('âš ï¸ Please enter a task!');
                return;
            }
            
            tasks.push({
                text: taskText,
                subject: subject,
                completed: false,
                createdAt: Date.now()
            });
            
            saveTasks();
            renderTasks();
            
            // Add to daily goals automatically
            const newGoal = {
                id: Date.now(),
                text: taskText,
                emoji: getSubjectEmoji(subject),
                category: 'Study',
                completed: false,
                fromChecklist: true
            };
            
            dailyGoals.push(newGoal);
            saveDailyProgress(dailyGoals);
            renderDailyProgress();
            
            taskInput.value = '';
            subjectInput.value = '';
            taskInput.focus();
            
            showNotification('âœ… Task added to checklist and daily goals!');
        }
        
        function getSubjectEmoji(subject) {
            const emojiMap = {
                'math': 'ðŸ”¢',
                'science': 'ðŸ”¬',
                'physics': 'âš›ï¸',
                'chemistry': 'âš—ï¸',
                'biology': 'ðŸ§¬',
                'history': 'ðŸ“œ',
                'english': 'ðŸ“–',
                'literature': 'ðŸ“š',
                'geography': 'ðŸŒ',
                'art': 'ðŸŽ¨',
                'music': 'ðŸŽµ',
                'programming': 'ðŸ’»',
                'coding': 'ðŸ‘¨â€ðŸ’»',
                'language': 'ðŸ—£ï¸',
                'economics': 'ðŸ“Š',
                'business': 'ðŸ’¼',
                'general': 'ðŸ“'
            };
            
            const subjectLower = subject.toLowerCase();
            return emojiMap[subjectLower] || 'ðŸ“';
        }
        
        function toggleTask(index) {
            tasks[index].completed = !tasks[index].completed;
            saveTasks();
            renderTasks();
            
            // Sync with daily goals
            const task = tasks[index];
            const goalIndex = dailyGoals.findIndex(goal => 
                goal.fromChecklist && goal.text === task.text
            );
            
            if (goalIndex !== -1) {
                dailyGoals[goalIndex].completed = task.completed;
                saveDailyProgress(dailyGoals);
                renderDailyProgress();
            }
        }
        
        function deleteTask(index) {
            const deletedTask = tasks[index];
            
            // Remove from daily goals if it was added from checklist
            const goalIndex = dailyGoals.findIndex(goal => 
                goal.fromChecklist && goal.text === deletedTask.text
            );
            
            if (goalIndex !== -1) {
                dailyGoals.splice(goalIndex, 1);
                saveDailyProgress(dailyGoals);
                renderDailyProgress();
            }
            
            tasks.splice(index, 1);
            saveTasks();
            renderTasks();
            showNotification('ðŸ—‘ï¸ Task deleted from checklist and goals');
        }
        
        // Event listeners for checklist
        addTaskBtn.addEventListener('click', addTask);
        
        taskInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                addTask();
            }
        });
        
        subjectInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                addTask();
            }
        });
        
        // Initial render of tasks
        renderTasks();
        
        // Daily Progress Checklist
        const dailyItemsList = document.getElementById('dailyItemsList');
        const dailyPercentage = document.getElementById('dailyPercentage');
        const dailyProgressBarFill = document.getElementById('dailyProgressBarFill');
        const dailyProgressText = document.getElementById('dailyProgressText');
        const dailyDate = document.getElementById('dailyDate');
        const dailyCelebration = document.getElementById('dailyCelebration');
        
        const defaultDailyGoals = [
            { id: 1, text: 'Complete 4 Pomodoro sessions', emoji: 'ðŸ…', category: 'Study', permanent: false },
            { id: 2, text: 'Review notes from yesterday', emoji: 'ðŸ“–', category: 'Study', permanent: false },
            { id: 3, text: 'Practice problems or exercises', emoji: 'âœï¸', category: 'Study', permanent: false },
            { id: 4, text: 'Take proper breaks', emoji: 'â˜•', category: 'Health', permanent: false },
            { id: 5, text: 'Avoid all distractions', emoji: 'ðŸŽ¯', category: 'Focus', permanent: false },
            { id: 6, text: 'Daily Workout', emoji: 'ðŸ’ª', category: 'Health', permanent: true, lifetime: true },
            { id: 7, text: 'Drink 2L Water', emoji: 'ðŸ’§', category: 'Health', permanent: true, lifetime: true }
        ];
        
        function getTodayKey() {
            const today = new Date();
            return `${today.getFullYear()}-${today.getMonth() + 1}-${today.getDate()}`;
        }
        
        function getFormattedDate() {
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            return new Date().toLocaleDateString('en-US', options);
        }
        
        function loadDailyProgress() {
            const todayKey = getTodayKey();
            const saved = localStorage.getItem('dailyProgress');
            
            if (saved) {
                const data = JSON.parse(saved);
                if (data.date === todayKey) {
                    // Same day - load saved goals but ensure all default goals are present
                    return ensureDefaultGoals(data.goals);
                }
            }
            
            // New day or no saved data - reset all goals
            return defaultDailyGoals.map(goal => ({ ...goal, completed: false }));
        }
        
        function ensureDefaultGoals(savedGoals) {
            // Start with default goals structure
            const goals = defaultDailyGoals.map(defaultGoal => {
                // Find if this goal exists in saved goals
                const savedGoal = savedGoals.find(g => g.id === defaultGoal.id);
                
                if (savedGoal) {
                    // Preserve completion status for saved goal
                    return { ...defaultGoal, completed: savedGoal.completed };
                } else {
                    // New default goal, add uncompleted
                    return { ...defaultGoal, completed: false };
                }
            });
            
            // Add any checklist goals that were saved
            const checklistGoals = savedGoals.filter(g => g.fromChecklist);
            goals.push(...checklistGoals);
            
            return goals;
        }
        
        function saveDailyProgress(goals) {
            const todayKey = getTodayKey();
            localStorage.setItem('dailyProgress', JSON.stringify({
                date: todayKey,
                goals: goals
            }));
        }
        
        let dailyGoals = loadDailyProgress();
        
        // Load completed tasks from localStorage
        let completedTasks = JSON.parse(localStorage.getItem('completedTasks')) || [];
        
        function saveCompletedTasks() {
            localStorage.setItem('completedTasks', JSON.stringify(completedTasks));
        }
        
        function renderCompletedTasks() {
            const completedTasksSection = document.getElementById('completedTasksSection');
            const completedTasksList = document.getElementById('completedTasksList');
            const completedCount = document.getElementById('completedCount');
            
            if (completedTasks.length === 0) {
                completedTasksSection.style.display = 'none';
                return;
            }
            
            completedTasksSection.style.display = 'block';
            completedCount.textContent = completedTasks.length;
            
            completedTasksList.innerHTML = completedTasks.map((task, index) => `
                <div class="completed-task-item">
                    <div class="daily-checkbox checked"></div>
                    <div class="completed-task-text">
                        <span class="daily-item-emoji">${task.emoji}</span>
                        ${escapeHtml(task.text)}
                    </div>
                </div>
            `).join('');
        }
        
        function renderDailyProgress() {
            dailyDate.textContent = getFormattedDate();
            
            const completedCount = dailyGoals.filter(g => g.completed).length;
            const totalCount = dailyGoals.length;
            const percentage = Math.round((completedCount / totalCount) * 100);
            
            dailyPercentage.textContent = `${percentage}%`;
            dailyProgressBarFill.style.width = `${percentage}%`;
            dailyProgressText.textContent = `${completedCount} of ${totalCount} goals completed`;
            
            dailyItemsList.innerHTML = dailyGoals.map((goal, index) => `
                <div class="daily-item ${goal.completed ? 'completed' : ''}" onclick="toggleDailyGoal(${index})">
                    <div class="daily-checkbox ${goal.completed ? 'checked' : ''}"></div>
                    <div class="daily-item-content">
                        <div class="daily-item-text">
                            <span class="daily-item-emoji">${goal.emoji}</span>
                            ${escapeHtml(goal.text)}
                            ${goal.category ? `<span class="goal-category-badge ${goal.category.toLowerCase()}">${goal.category}</span>` : ''}
                            ${goal.lifetime ? '<span class="lifetime-badge">Lifetime Goal</span>' : ''}
                            ${goal.fromChecklist ? '<span style="margin-left: 8px; font-size: 10px; color: var(--text-secondary);">(from checklist)</span>' : ''}
                        </div>
                    </div>
                </div>
            `).join('');
            
            // Show celebration if all goals completed
            if (completedCount === totalCount && totalCount > 0) {
                dailyCelebration.innerHTML = `
                    <div class="daily-complete-celebration">
                        <div class="daily-complete-celebration-emoji">ðŸŽ‰</div>
                        <div class="daily-complete-celebration-text">All Daily Goals Complete!</div>
                        <div style="font-size: 13px; color: var(--text-secondary); margin-top: 8px;">Amazing work today! Keep it up! ðŸ’ª</div>
                    </div>
                `;
            } else {
                dailyCelebration.innerHTML = '';
            }
        }
        
        function toggleDailyGoal(index) {
            dailyGoals[index].completed = !dailyGoals[index].completed;
            const goal = dailyGoals[index];
            
            // Sync with checklist if this goal came from checklist
            if (goal.fromChecklist) {
                const taskIndex = tasks.findIndex(task => task.text === goal.text);
                if (taskIndex !== -1) {
                    tasks[taskIndex].completed = goal.completed;
                    saveTasks();
                    renderTasks();
                }
            }
            
            saveDailyProgress(dailyGoals);
            renderDailyProgress();
            
            if (goal.completed) {
                showNotification('ðŸŽ¯ Goal completed!');
                
                // Auto-remove study tasks after 2 seconds (but NOT lifetime goals)
                if (goal.fromChecklist && !goal.permanent && !goal.lifetime) {
                    setTimeout(() => {
                        // Move to completed tasks
                        completedTasks.unshift({
                            text: goal.text,
                            emoji: goal.emoji,
                            completedAt: Date.now()
                        });
                        saveCompletedTasks();
                        renderCompletedTasks();
                        
                        // Remove from daily goals
                        const currentIndex = dailyGoals.findIndex(g => g.id === goal.id);
                        if (currentIndex !== -1) {
                            dailyGoals.splice(currentIndex, 1);
                            saveDailyProgress(dailyGoals);
                            renderDailyProgress();
                        }
                    }, 2000);
                }
            }
        }
        
        // Initial render
        renderDailyProgress();
        renderCompletedTasks();
        updateProgressRing();
        updateHeatmap();
        updateRPGLevel();
        
        // Goal edit modal
        const editGoalBtn = document.getElementById('editGoalBtn');
        const goalModalOverlay = document.getElementById('goalModalOverlay');
        const goalHoursInput = document.getElementById('goalHoursInput');
        const saveGoalBtn = document.getElementById('saveGoalBtn');
        const cancelGoalBtn = document.getElementById('cancelGoalBtn');
        
        editGoalBtn.addEventListener('click', () => {
            goalHoursInput.value = dailyStudyGoalHours;
            goalModalOverlay.classList.add('active');
            goalHoursInput.focus();
        });
        
        cancelGoalBtn.addEventListener('click', () => {
            goalModalOverlay.classList.remove('active');
        });
        
        saveGoalBtn.addEventListener('click', () => {
            const newGoal = parseFloat(goalHoursInput.value);
            if (newGoal > 0 && newGoal <= 24) {
                dailyStudyGoalHours = newGoal;
                localStorage.setItem('dailyStudyGoal', dailyStudyGoalHours);
                updateProgressRing();
                goalModalOverlay.classList.remove('active');
                showNotification(`ðŸŽ¯ Daily goal set to ${dailyStudyGoalHours} hours!`);
            } else {
                showNotification('âš ï¸ Please enter a valid goal (0-24 hours)');
            }
        });
        
        goalModalOverlay.addEventListener('click', (e) => {
            if (e.target === goalModalOverlay) {
                goalModalOverlay.classList.remove('active');
            }
        });
        
        // Auto-reset check: Check every minute if the date has changed
        setInterval(() => {
            const currentDate = getTodayKey();
            const saved = localStorage.getItem('dailyProgress');
            
            if (saved) {
                const data = JSON.parse(saved);
                if (data.date !== currentDate) {
                    // Date changed! Reset all goals
                    dailyGoals = defaultDailyGoals.map(goal => ({ ...goal, completed: false }));
                    saveDailyProgress(dailyGoals);
                    renderDailyProgress();
                    showNotification('ðŸŒ… New day! Daily goals have been reset.');
                }
            }
            
            // Check for new day in study progress
            checkNewDay();
            updateProgressRing();
        }, 60000); // Check every minute
        
        // Fullscreen functionality
        fullscreenBtn.addEventListener('click', () => {
            fullscreenOverlay.classList.add('active');
            updateDisplay(); // Sync the display
        });
        
        exitFullscreenBtn.addEventListener('click', () => {
            fullscreenOverlay.classList.remove('active');
        });
        
        // Fullscreen controls
        fullscreenStartBtn.addEventListener('click', start);
        fullscreenResetBtn.addEventListener('click', reset);
        
        // Reset daily goals button
        const resetGoalsBtn = document.getElementById('resetGoalsBtn');
        resetGoalsBtn.addEventListener('click', () => {
            if (confirm('Reset daily goals? This will uncheck all goals and remove checklist items. Lifetime goals will remain.')) {
                // Reset to default goals with all unchecked
                dailyGoals = defaultDailyGoals.map(goal => ({ ...goal, completed: false }));
                saveDailyProgress(dailyGoals);
                renderDailyProgress();
                showNotification('ðŸ”„ Daily goals reset! Lifetime goals preserved.');
            }
        });
        
        // Completed tasks toggle
        const completedTasksHeader = document.getElementById('completedTasksHeader');
        const completedTasksList = document.getElementById('completedTasksList');
        const toggleIcon = document.getElementById('toggleIcon');
        
        completedTasksHeader.addEventListener('click', (e) => {
            // Don't toggle if clicking the clear button
            if (e.target.id === 'clearCompletedBtn') return;
            
            completedTasksList.classList.toggle('show');
            toggleIcon.classList.toggle('expanded');
        });
        
        // Clear completed tasks
        const clearCompletedBtn = document.getElementById('clearCompletedBtn');
        clearCompletedBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            if (confirm('Clear all completed tasks?')) {
                completedTasks = [];
                saveCompletedTasks();
                renderCompletedTasks();
                showNotification('ðŸ—‘ï¸ Completed tasks cleared!');
            }
        });
        
        // ESC key to exit fullscreen
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && fullscreenOverlay.classList.contains('active')) {
                fullscreenOverlay.classList.remove('active');
            }
        });
        
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }
        
        function updateDisplay() {
            timeDisplay.textContent = formatTime(timeLeft);
            const progress = ((totalTime - timeLeft) / totalTime) * 100;
            progressFill.style.width = `${progress}%`;
            
            // Update circular progress with ticking animation
            const offset = circumference - (progress / 100) * circumference;
            if (isRunning) {
                circularProgress.classList.add('ticking');
            } else {
                circularProgress.classList.remove('ticking');
            }
            circularProgress.style.strokeDashoffset = offset;
            
            // Update fullscreen display
            fullscreenTimeDisplay.textContent = formatTime(timeLeft);
            const fullscreenOffset = fullscreenCircumference - (progress / 100) * fullscreenCircumference;
            fullscreenCircularProgress.style.strokeDashoffset = fullscreenOffset;
            
            // Update fullscreen stats
            fullscreenSessions.textContent = sessionsCount;
            fullscreenMinutes.textContent = totalMinutesStudied;
        }
        
        function updateMode(mode) {
            currentMode = mode;
            
            // Remove all mode classes
            timeDisplay.classList.remove('focus', 'break', 'long-break');
            modeName.classList.remove('focus', 'break', 'long-break');
            progressFill.classList.remove('focus', 'break', 'long-break');
            circularProgress.classList.remove('focus', 'break', 'long-break');
            timerCard.classList.remove('active-focus', 'active-break', 'active-long-break');
            fullscreenModeName.classList.remove('focus', 'break', 'long-break');
            fullscreenTimeDisplay.classList.remove('focus', 'break', 'long-break');
            fullscreenCircularProgress.classList.remove('focus', 'break', 'long-break');
            
            if (mode === 'focus') {
                timeLeft = FOCUS_TIME;
                totalTime = FOCUS_TIME;
                modeName.textContent = 'FOCUS TIME';
                timerModeLabel.textContent = 'Focus Session';
                fullscreenModeName.textContent = 'FOCUS TIME';
                fullscreenLabel.textContent = 'Focus Session';
                timeDisplay.classList.add('focus');
                modeName.classList.add('focus');
                fullscreenModeName.classList.add('focus');
                fullscreenTimeDisplay.classList.add('focus');
                startBtn.style.background = 'var(--focus-red)';
                fullscreenStartBtn.style.background = 'var(--focus-red)';
            } else if (mode === 'break') {
                timeLeft = SHORT_BREAK;
                totalTime = SHORT_BREAK;
                modeName.textContent = 'SHORT BREAK';
                timerModeLabel.textContent = 'Take a Break';
                fullscreenModeName.textContent = 'SHORT BREAK';
                fullscreenLabel.textContent = 'Take a Break';
                timeDisplay.classList.add('break');
                modeName.classList.add('break');
                progressFill.classList.add('break');
                circularProgress.classList.add('break');
                fullscreenModeName.classList.add('break');
                fullscreenTimeDisplay.classList.add('break');
                fullscreenCircularProgress.classList.add('break');
                startBtn.style.background = 'var(--break-green)';
                fullscreenStartBtn.style.background = 'var(--break-green)';
            } else if (mode === 'long-break') {
                timeLeft = LONG_BREAK;
                totalTime = LONG_BREAK;
                modeName.textContent = 'LONG BREAK';
                timerModeLabel.textContent = 'Long Break';
                fullscreenModeName.textContent = 'LONG BREAK';
                fullscreenLabel.textContent = 'Long Break';
                timeDisplay.classList.add('long-break');
                modeName.classList.add('long-break');
                progressFill.classList.add('long-break');
                circularProgress.classList.add('long-break');
                fullscreenModeName.classList.add('long-break');
                fullscreenTimeDisplay.classList.add('long-break');
                fullscreenCircularProgress.classList.add('long-break');
                startBtn.style.background = 'var(--long-break-blue)';
                fullscreenStartBtn.style.background = 'var(--long-break-blue)';
            }
            
            updateDisplay();
        }
        
        function showNotification(message) {
            notificationText.textContent = message;
            notification.classList.add('show');
            
            // Play a sound if available
            try {
                const audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIGWi77OibUBENUqfk77RiGwU7k9nywn0zBS195PPTjjUHDVO94+e1VhMMQJLN8d+OPQYRW7Ts7qJTGhBFluDvvnEfBDSH0e/XiiUEHGu/7+qlXBYMRZjd8b9xIQQ0h9Hv14olBBxrv+/qpVwWDESY3fG/cSEENIfR79eKJQQca7/v6qVcFgxEmN3xv3EhBDSH0e/XiiUEHGu/7+qlXBYMRJjd8b9xIQQ0h9Hv14olBBxrv+/qpVwWDESY3fG/cSEENIfR79eKJQQca7/v6qVcFgxEmN3xv3EhBDSH0e/XiiUEHGu/7+qlXBYMRJjd8b9xIQQ0h9Hv14olBBxrv+/qpVwWDESY3fG/cSEENIfR79eKJQQca7/v6qVcFgxEmN3xv3EhBDSH0e/XiiUEHGu/7+qlXBYMRJjd8b9xIQQ0h9Hv14olBBxrv+/qpVwWDESY3fG/cSEENIfR79eKJQQca7/v6qVcFgxEmN3xv3EhBDSH0e/XiiUEHGu/7+qlXBYMRJjd8b9xIQQ0h9Hv14olBBxrv+/qpVwWDESY3fG/cSEENIfR79eKJQQca7/v6qVcFgxEmN3xv3EhBDSH0e/XiiUEHGu/7+qlXBYMRJjd8b9xIQQ0h9Hv14olBBxrv+/qpVwWDESY3fG/cSEENIfR79eKJQQca7/v6qVcFgxEmN3xv3EhBDSH0e/XiiUEHGu/7+qlXBYMRJjd8b9xIQQ0h9Hv14olBBxrv+/qpVwWDESY3fG/cSEENIfR79eKJQQca7/v6qVcFgxEmN3xv3EhBDSH0e/XiiUEHGu/7+qlXBYMRJjd8b9xIQQ0h9Hv14olBBxrv+/qpVwWDESY3fG/cQ==');
                audio.play();
            } catch (e) {
                // Silently fail if audio doesn't work
            }
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        
        function tick() {
            if (timeLeft > 0) {
                timeLeft--;
                
                // Track study time only during focus sessions
                if (currentMode === 'focus') {
                    todayStudySeconds++;
                    
                    // Update RPG level (every 60 seconds = 1 minute)
                    if (todayStudySeconds % 60 === 0) {
                        totalFocusMinutes++;
                        localStorage.setItem('totalFocusMinutes', totalFocusMinutes);
                        updateRPGLevel();
                    }
                    
                    saveStudyProgress();
                    updateProgressRing();
                    updateHeatmap();
                }
                
                updateDisplay();
            } else {
                // Timer completed - play completion sound
                playSound('complete');
                stop();
                
                if (currentMode === 'focus') {
                    sessionsCount++;
                    totalMinutesStudied += 25;
                    sessionsCompleted.textContent = sessionsCount;
                    totalMinutesEl.textContent = totalMinutesStudied;
                    
                    // Add to session history
                    addSessionToHistory('focus', FOCUS_TIME);
                    
                    if (sessionsCount % 4 === 0) {
                        showNotification('ðŸŽ‰ Great work! Time for a long break!');
                        updateMode('long-break');
                        // Auto-start break timer
                        setTimeout(() => {
                            start();
                        }, 2000);
                    } else {
                        showNotification('âœ¨ Session complete! Take a short break.');
                        updateMode('break');
                        // Auto-start break timer
                        setTimeout(() => {
                            start();
                        }, 2000);
                    }
                } else {
                    // Break completed
                    const breakType = currentMode === 'long-break' ? 'long-break' : 'break';
                    const breakDuration = currentMode === 'long-break' ? LONG_BREAK : SHORT_BREAK;
                    addSessionToHistory(breakType, breakDuration);
                    
                    showNotification('ðŸ’ª Break over! Ready to focus?');
                    updateMode('focus');
                    // Don't auto-start focus - let user start when ready
                }
            }
        }
        
        function start() {
            if (!isRunning) {
                isRunning = true;
                startBtn.textContent = 'Pause';
                fullscreenStartBtn.textContent = 'Pause';
                interval = setInterval(tick, 1000);
                
                // Show sync music reminder when starting focus mode
                if (currentMode === 'focus') {
                    const syncReminder = document.getElementById('syncReminder');
                    syncReminder.classList.add('show');
                    
                    // Hide reminder after 5 seconds
                    setTimeout(() => {
                        syncReminder.classList.remove('show');
                    }, 5000);
                }
                
                if (currentMode === 'focus') {
                    timerCard.classList.add('active-focus');
                } else if (currentMode === 'break') {
                    timerCard.classList.add('active-break');
                } else {
                    timerCard.classList.add('active-long-break');
                }
            } else {
                stop();
            }
        }
        
        function stop() {
            isRunning = false;
            startBtn.textContent = 'Start';
            fullscreenStartBtn.textContent = 'Start';
            clearInterval(interval);
            timerCard.classList.remove('active-focus', 'active-break', 'active-long-break');
        }
        
        function reset() {
            stop();
            updateMode(currentMode);
        }
        
        startBtn.addEventListener('click', start);
        resetBtn.addEventListener('click', reset);
        
        // Scroll to top button functionality
        const scrollBtn = document.getElementById('scrollBtn');
        
        window.addEventListener('scroll', () => {
            if (window.scrollY > 300) {
                scrollBtn.classList.add('visible');
            } else {
                scrollBtn.classList.remove('visible');
            }
        });
        
        scrollBtn.addEventListener('click', () => {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        });
        
        // Backup & Restore functionality
        const downloadBackupBtn = document.getElementById('downloadBackupBtn');
        const restoreBackupBtn = document.getElementById('restoreBackupBtn');
        const restoreFileInput = document.getElementById('restoreFileInput');
        
        function createBackup() {
            const backupData = {
                version: '1.0',
                exportDate: new Date().toISOString(),
                data: {
                    // Study progress
                    studyProgressData: studyProgressData,
                    dailyStudyGoal: dailyStudyGoalHours,
                    
                    // RPG Level system
                    totalFocusMinutes: totalFocusMinutes,
                    currentLevel: currentLevel,
                    
                    // Heatmap data
                    heatmapData: heatmapData,
                    
                    // Tasks and goals
                    studyTasks: tasks,
                    dailyProgress: JSON.parse(localStorage.getItem('dailyProgress') || '{}'),
                    completedTasks: completedTasks,
                    
                    // Session stats and history
                    sessionsCount: sessionsCount,
                    totalMinutesStudied: totalMinutesStudied,
                    sessionHistory: sessionHistory,
                    
                    // Streak (saved separately for redundancy)
                    currentStreak: studyProgressData.streak
                }
            };
            
            return backupData;
        }
        
        function downloadBackup() {
            const backupData = createBackup();
            const dataStr = JSON.stringify(backupData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            const downloadLink = document.createElement('a');
            downloadLink.href = URL.createObjectURL(dataBlob);
            
            const timestamp = new Date().toISOString().split('T')[0];
            downloadLink.download = `focus-flow-backup-${timestamp}.json`;
            
            document.body.appendChild(downloadLink);
            downloadLink.click();
            document.body.removeChild(downloadLink);
            
            showNotification('ðŸ’¾ Backup downloaded successfully!');
        }
        
        function restoreBackup(backupData) {
            try {
                if (!backupData.version || !backupData.data) {
                    throw new Error('Invalid backup file format');
                }
                
                const data = backupData.data;
                
                // Restore study progress
                if (data.studyProgressData) {
                    studyProgressData = data.studyProgressData;
                    todayStudySeconds = studyProgressData.todaySeconds;
                    localStorage.setItem('studyProgressData', JSON.stringify(studyProgressData));
                    localStorage.setItem('currentStreak', studyProgressData.streak);
                }
                
                if (data.dailyStudyGoal) {
                    dailyStudyGoalHours = data.dailyStudyGoal;
                    localStorage.setItem('dailyStudyGoal', dailyStudyGoalHours);
                }
                
                // Restore RPG level
                if (data.totalFocusMinutes !== undefined) {
                    totalFocusMinutes = data.totalFocusMinutes;
                    previousLevel = Math.floor(totalFocusMinutes / 60) + 1;
                    localStorage.setItem('totalFocusMinutes', totalFocusMinutes);
                    if (data.currentLevel) {
                        localStorage.setItem('currentLevel', data.currentLevel);
                    }
                }
                
                // Restore heatmap
                if (data.heatmapData) {
                    heatmapData = data.heatmapData;
                    localStorage.setItem('heatmapData', JSON.stringify(heatmapData));
                }
                
                // Restore tasks and goals
                if (data.studyTasks) {
                    tasks = data.studyTasks;
                    localStorage.setItem('studyTasks', JSON.stringify(tasks));
                }
                
                if (data.dailyProgress) {
                    localStorage.setItem('dailyProgress', JSON.stringify(data.dailyProgress));
                    dailyGoals = loadDailyProgress();
                }
                
                if (data.completedTasks) {
                    completedTasks = data.completedTasks;
                    localStorage.setItem('completedTasks', JSON.stringify(completedTasks));
                }
                
                // Restore session stats and history
                if (data.sessionsCount !== undefined) {
                    sessionsCount = data.sessionsCount;
                }
                
                if (data.totalMinutesStudied !== undefined) {
                    totalMinutesStudied = data.totalMinutesStudied;
                }
                
                if (data.sessionHistory) {
                    sessionHistory = data.sessionHistory;
                    localStorage.setItem('sessionHistory', JSON.stringify(sessionHistory));
                }
                
                // Update all displays
                renderTasks();
                renderDailyProgress();
                renderCompletedTasks();
                updateProgressRing();
                updateHeatmap();
                updateRPGLevel();
                sessionsCompleted.textContent = sessionsCount;
                totalMinutesEl.textContent = totalMinutesStudied;
                
                showNotification('âœ… Backup restored successfully!');
                
            } catch (error) {
                console.error('Restore error:', error);
                showNotification('âŒ Failed to restore backup. Please check the file.');
            }
        }
        
        downloadBackupBtn.addEventListener('click', downloadBackup);
        
        restoreBackupBtn.addEventListener('click', () => {
            restoreFileInput.click();
        });
        
        restoreFileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const backupData = JSON.parse(event.target.result);
                        
                        if (confirm('This will replace all your current data with the backup. Continue?')) {
                            restoreBackup(backupData);
                        }
                    } catch (error) {
                        showNotification('âŒ Invalid backup file format');
                    }
                    
                    // Reset file input
                    restoreFileInput.value = '';
                };
                reader.readAsText(file);
            }
        });
        
        // Ambient Audio Mixer
        const audioSounds = {
            rain: new Audio('https://cdn.pixabay.com/download/audio/2022/05/13/audio_257112ce99.mp3'),
            forest: new Audio('https://cdn.pixabay.com/download/audio/2022/03/10/audio_2c0fc3e0c5.mp3'),
            whitenoise: new Audio('https://cdn.pixabay.com/download/audio/2022/03/24/audio_c8a7340a29.mp3'),
            lofi: new Audio('https://cdn.pixabay.com/download/audio/2022/05/27/audio_1808fbf07a.mp3')
        };
        
        // Set all audio to loop
        Object.values(audioSounds).forEach(audio => {
            audio.loop = true;
        });
        
        // Load saved volumes from localStorage
        Object.keys(audioSounds).forEach(soundName => {
            const savedVolume = localStorage.getItem(`${soundName}-volume`);
            if (savedVolume !== null) {
                const volume = parseInt(savedVolume);
                audioSounds[soundName].volume = volume / 100;
                document.getElementById(`${soundName}-volume`).value = volume;
                document.getElementById(`${soundName}-value`).textContent = `${volume}%`;
            } else {
                audioSounds[soundName].volume = 0.7;
            }
        });
        
        // Play/Pause functionality
        document.querySelectorAll('.play-pause-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const soundName = btn.dataset.sound;
                const audio = audioSounds[soundName];
                const card = document.getElementById(`${soundName}-card`);
                
                if (audio.paused) {
                    audio.play().then(() => {
                        btn.textContent = 'â¸';
                        btn.classList.add('playing');
                        card.classList.add('playing');
                    }).catch(err => {
                        console.log('Audio play failed:', err);
                        showNotification('âš ï¸ Audio playback failed. Try clicking again.');
                    });
                } else {
                    audio.pause();
                    btn.textContent = 'â–¶';
                    btn.classList.remove('playing');
                    card.classList.remove('playing');
                }
            });
        });
        
        // Volume control
        document.querySelectorAll('.volume-slider').forEach(slider => {
            slider.addEventListener('input', (e) => {
                const soundName = e.target.id.replace('-volume', '');
                const volume = e.target.value;
                
                audioSounds[soundName].volume = volume / 100;
                document.getElementById(`${soundName}-value`).textContent = `${volume}%`;
                
                // Save to localStorage
                localStorage.setItem(`${soundName}-volume`, volume);
            });
        });
        
        // Initialize display
        updateDisplay();
    </script>
    
    <!-- PWA Service Worker Registration (Optional - only works when deployed) -->
    <script>
        if ('serviceWorker' in navigator && window.location.protocol === 'https:') {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then(registration => {
                        console.log('âœ… Service Worker registered successfully');
                    })
                    .catch(error => {
                        console.log('â„¹ï¸ Service Worker not available (app works fine without it)');
                    });
            });
        }
        
        // PWA Install Prompt
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            // Show install notification after 10 seconds
            setTimeout(() => {
                if (deferredPrompt && !localStorage.getItem('pwaInstallDismissed')) {
                    showNotification('ðŸ“± Tip: Install Focus Flow as an app for quick access!');
                }
            }, 10000);
        });
        
        window.addEventListener('appinstalled', () => {
            deferredPrompt = null;
            showNotification('âœ… Focus Flow installed successfully!');
        });
    </script>
</body>
</html>
